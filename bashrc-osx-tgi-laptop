function tab {
    # from: https://gist.github.com/bobthecow/757788
    # and https://stackoverflow.com/questions/38692346/new-tab-in-iterm2
	# this function is only meant for MacOS and iTerm2
    local cmd=""
    local cdto="$PWD"
    local args="$@"

    if [ -d "$1" ]; then
        cdto=`cd "$1"; pwd`
        args="${@:2}"
    fi

    if [ -n "$args" ]; then
        cmd="$args"
    fi

    osascript &>/tmp/log <<EOF
tell application "iTerm2"
    activate
    tell current window to set tb to create tab with default profile
    tell current session of current window to write text "cd ${cdto};${cmd}"
end tell
EOF
}

function join_by { local IFS="$1"; shift; echo "$*"; }

# set a fancy prompt (non-color, unless we know we "want" color)
case "$TERM" in
    xterm) colorize=yes;;
    xterm-color) colorize=yes;;
    xterm-256color) colorize=yes;;
    screen-256color) colorize=yes;;
    eterm-color) colorize=yes;;
esac

if [ "$colorize" == "yes" ]; then
    # enable aliases
    alias ls='ls -G'
    alias grep='grep --color=auto'

    # colors via tput
    reset=$(tput sgr0)
    bold=$(tput bold)
    grey=$(tput setaf 0)
    red=$(tput setaf 1)
    green=$(tput setaf 2)
    yellow=$(tput setaf 3)
    blue=$(tput setaf 4)
    magenta=$(tput setaf 5)
    cyan=$(tput setaf 6)
    white=$(tput setaf 7)

    xreset=$(tput -T xterm sgr0)
    xbold=$(tput -T xterm bold)
    xgrey=$(tput -T xterm setaf 0)
    xred=$(tput -T xterm setaf 1)
    xgreen=$(tput -T xterm setaf 2)
    xyellow=$(tput -T xterm setaf 3)
    xblue=$(tput -T xterm setaf 4)
    xmagenta=$(tput -T xterm setaf 5)
    xcyan=$(tput -T xterm setaf 6)
    xwhite=$(tput -T xterm setaf 7)

    # setup a custom prompt
    case "$TERM" in
        "dumb")
            export PS1="> "
            ;;
        eterm-color)
            export PS1='╭─( ${yellow}\w${reset}${red}$(__git_ps1 " (%s)")${reset} as ${green}\u${reset} at ${cyan}\h${reset} on ${yellow}\D{%m/%d} \t${reset} )\n╰─${bold}${red}\$${reset} '
            ;;
        xterm*|rxvt*|eterm*|screen*)
            export PS1='╭─\[${xreset}\]( \[${xyellow}\]\w\[${xred}\]$(__git_ps1 " (%s)")\[${xreset}\] as \[${xgreen}\]\u\[${xreset}\] at \[${xcyan}\]\h\[${xreset}\] on \[${xyellow}\]\D{%m/%d} \t\[${xreset}\] )\n╰─\[${xbold}\]\[${xred}\]$\[${xreset}\] '
            ;;
    esac
fi

unset colorize

# enable branch notification niceties on the prompt
if [ -f /usr/share/git-core/git-prompt.sh ]; then
    source /usr/share/git-core/git-prompt.sh
else
    source ~/.git-prompt.sh
fi

# get vim's slimux/tmux integration to work correctly on MacOS (OSX)
# see https://github.com/epeli/slimux/issues/61
export EVENT_NOKQUEUE=1
export EVENT_NOPOLL=1

# commands beginning with one space don't get stored in .bash_history
export HISTIGNORE=' *'

# original $PATH from initial purchase
#export PATH=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/opt/X11/bin

# account for 'homebrew'ed software
declare -a extra_paths=(
    $HOME/.goenv/bin
    $HOME/.pyenv/bin
    $HOME/.rbenv/bin
    $HOME/.Renv/bin
    $HOME/.plenv/bin
    $HOME/bin
    /usr/bin
    /bin
    /usr/sbin
    /sbin
    /usr/local/bin
    /opt/X11/bin
)
NEW_PATHS=$(join_by : "${extra_paths[@]}")
export PATH=$NEW_PATHS

# rbenv setup
if which rbenv > /dev/null; then eval "$(rbenv init -)"; fi

# pyenv setup
if which pyenv > /dev/null; then eval "$(pyenv init -)"; fi

# pyenv virtualenv setup
if which pyenv > /dev/null; then eval "$(pyenv virtualenv-init -)"; fi

# plenv setup
if which plenv > /dev/null; then eval "$(plenv init -)"; fi

# Renv setup
if which Renv > /dev/null; then eval "$(Renv init -)"; fi

# goenv setup
if which goenv > /dev/null; then eval "$(goenv init -)"; fi

# java setup
export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_45.jdk/Contents/Home
export PATH=$HOME/idas/local/maven/apache-maven-3.5.4/bin:$PATH

# scala setup
export SCALA_HOME=$HOME/software/scala/scala-2.11.8
export PATH=$SCALA_HOME/bin:$PATH

# google-cloud
source /usr/local/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/path.bash.inc
source /usr/local/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/completion.bash.inc

# rust setup
export PATH=$HOME/.cargo/bin:$PATH

# roswell/common-lisp setup
export PATH=$HOME/.roswell/bin:$PATH

# iTerm2 shortcuts
# based on http://stackoverflow.com/questions/8598021/iterm-2-profiles
function it2profile() { echo -e "\033]50;SetProfile=$1\a"; }
export -f it2profile

# iterm2 shell integration
if [ "$TERM" != "eterm-color" ] || [ "$TERM" != "dumb" ]; then
    # inside emacs skip this
    test -e "${HOME}/.iterm2_shell_integration.bash" \
        && source "${HOME}/.iterm2_shell_integration.bash"
fi

# set the default editor
alias nvim='/usr/local/bin/nvim'
alias vim="$HOME/idas/local/vim8/bin/vim"
alias mvim="$HOME/idas/local/vim8/MacVim.app/Contents/bin/mvim"
export EDITOR="/usr/local/bin/nvim"

